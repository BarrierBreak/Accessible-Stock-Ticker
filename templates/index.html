<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Ticker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .stock-info {
            display: inline-block;
            margin-right: 20px;
        }

        #main_heading {
            padding-top: 3%;
        }
        .up-arrow {
            color: green;
        }

        .down-arrow {
            color: red;
        }
        #announceBtn:focus {
            border: 2px solid black;
        }
        #notAnnounceBtn:focus {
            border: 2px solid black;
        }
        #setPoliteBtn:focus {
            border: 2px solid black;
        }
        .container{
            text-align: center;
        }
        #stock-ticker{
            padding: 3%;
        }
        .stock-ticker-list{
            display: inline-flex;
        }
        ul {
            list-style-type: none;
        }
        .logo-img {
            width: 20%;
            padding-bottom: 2%;
        }
        @media (max-width: 768px) {
            .logo-img {
                width: 80%;
                padding-bottom: 10%;
            }
            .cust-pos svg {
                width: 30px;
                height: 30px;
                margin-bottom: 10px;
            }
        }
        .cust-pos {
            display: flex;
            margin-top: 20px;
        }

        .cust-pos svg {
            width: 100px;
            height: 50px;
            margin-right: 10px;
            margin-top: -1%;
        }

        .cust-pos p {
            margin: 0;
        }

        .copyright {
            margin-top: 10%;
            text-align: center;
            padding: 20px 0;
            background-color: #f8f9fa;
        }

    </style>
</head>
<body>

    <div class="container mt-5">
        <a class="logo" href="https://www.barrierbreak.com/" target="_blank" rel="noopener noreferrer">
            <svg rol="img" aria-label="BarrierBreak" width="165" height="64" viewBox="0 0 165 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M29.7324 49.1082V54.0959H34.1883V49.1082C34.1883 43.052 36.0678 40.2016 53.2209 40.2016H62.9394C59.3165 53.8988 46.8428 64 31.998 64C17.1531 64 4.57985 53.8135 1.01797 40.031H28.9176V35.5756H0.201156C0.0670522 34.4014 0 33.2048 0 31.998C0 30.7912 0.0670522 29.5966 0.201156 28.4203H10.6511C19.6787 28.4203 24.7909 27.693 28.2898 25.9153C32.2763 23.8938 34.1355 20.4401 34.1355 15.0583V10.0667H29.6796V15.0583C29.6796 21.1105 27.8001 23.965 10.6511 23.965H1.01594C4.57985 10.1845 17.0982 0 32 0C46.9018 0 59.5238 10.2617 63.0267 24.1295H34.9503V28.5849H63.8171C63.937 29.7063 64 30.842 64 31.9959C64 33.2657 63.9268 34.5111 63.7806 35.7422H53.2189C37.6405 35.7422 29.7304 37.8084 29.7304 49.1042L29.7324 49.1082Z" fill="#F16E00"/>
                <path d="M73.2402 6.71998H80.4402C84.0562 6.71998 87.3522 7.80798 87.3522 12.064C87.3522 14.176 86.1362 15.648 84.4082 16.544C86.8082 17.152 88.4402 18.816 88.4402 21.632C88.4402 25.792 85.5602 28 80.2482 28H73.2402V6.71998ZM77.1442 18.304V24.992H80.1522C83.2882 24.992 84.3122 23.552 84.3122 21.6C84.3122 19.456 82.8402 18.304 80.3122 18.304H77.1442ZM77.1442 9.66398V15.456H79.5122C82.2642 15.456 83.3842 14.176 83.3842 12.48C83.3842 10.176 81.8162 9.66398 79.7362 9.66398H77.1442Z" fill="#333333"/>
                <path d="M104.763 12.544V24.928L105.051 28H101.755L101.531 26.304L101.403 26.272C100.411 27.712 98.7787 28.416 97.0187 28.416C92.5067 28.416 90.7467 25.216 90.7467 20.64C90.7467 15.008 93.5627 11.424 99.0667 11.424C100.123 11.424 102.459 11.68 104.763 12.544ZM100.987 22.912V14.624C100.507 14.4 99.5787 14.208 98.5867 14.208C95.5467 14.208 94.5227 17.056 94.5227 20.512C94.5227 23.168 95.1627 25.696 97.8507 25.696C99.8347 25.696 100.987 24.288 100.987 22.912Z" fill="#333333"/>
                <path d="M112.638 17.888V28H108.83V14.496L108.542 11.904H111.678L112.062 14.24C112.766 12.416 114.334 11.424 115.934 11.424C116.894 11.424 117.79 11.648 118.494 12.064L117.822 15.296C117.118 14.912 116.382 14.656 115.55 14.656C113.822 14.656 112.702 16.032 112.638 17.888Z" fill="#333333"/>
                <path d="M124.357 17.888V28H120.549V14.496L120.261 11.904H123.397L123.781 14.24C124.485 12.416 126.053 11.424 127.653 11.424C128.613 11.424 129.509 11.648 130.213 12.064L129.541 15.296C128.837 14.912 128.101 14.656 127.269 14.656C125.541 14.656 124.421 16.032 124.357 17.888Z" fill="#333333"/>
                <path d="M136.076 28H132.268V11.904H136.076V28ZM131.948 7.29598C131.948 6.11198 132.844 5.15198 134.156 5.15198C135.468 5.15198 136.364 6.11198 136.364 7.29598C136.364 8.51198 135.436 9.40798 134.156 9.40798C132.812 9.40798 131.948 8.51198 131.948 7.29598Z" fill="#333333"/>
                <path d="M146.992 11.424C150.128 11.424 152.08 13.024 152.08 15.872C152.08 20.8 145.968 21.44 143.024 21.472C143.152 23.552 144.336 25.568 147.056 25.568C148.944 25.568 150.32 24.704 151.088 24.16L152.272 26.688C151.76 27.136 149.648 28.48 146.64 28.48C141.36 28.48 139.184 25.088 139.184 20.288C139.184 15.584 141.904 11.424 146.992 11.424ZM148.688 16.032C148.688 14.848 147.92 14.144 146.768 14.144C144.208 14.144 142.992 16.64 142.896 19.008C144.624 19.04 148.688 18.496 148.688 16.032Z" fill="#333333"/>
                <path d="M158.669 17.888V28H154.861V14.496L154.573 11.904H157.709L158.093 14.24C158.797 12.416 160.365 11.424 161.965 11.424C162.925 11.424 163.821 11.648 164.525 12.064L163.853 15.296C163.149 14.912 162.413 14.656 161.581 14.656C159.853 14.656 158.733 16.032 158.669 17.888Z" fill="#333333"/>
                <path d="M73.2402 35.72H80.4402C84.0562 35.72 87.3522 36.808 87.3522 41.064C87.3522 43.176 86.1362 44.648 84.4082 45.544C86.8082 46.152 88.4402 47.816 88.4402 50.632C88.4402 54.792 85.5602 57 80.2482 57H73.2402V35.72ZM77.1442 47.304V53.992H80.1522C83.2882 53.992 84.3122 52.552 84.3122 50.6C84.3122 48.456 82.8402 47.304 80.3122 47.304H77.1442ZM77.1442 38.664V44.456H79.5122C82.2642 44.456 83.3842 43.176 83.3842 41.48C83.3842 39.176 81.8162 38.664 79.7362 38.664H77.1442Z" fill="#333333"/>
                <path d="M95.4507 46.888V57H91.6427V43.496L91.3547 40.904H94.4907L94.8747 43.24C95.5787 41.416 97.1467 40.424 98.7467 40.424C99.7067 40.424 100.603 40.648 101.307 41.064L100.635 44.296C99.9307 43.912 99.1947 43.656 98.3627 43.656C96.6347 43.656 95.5147 45.032 95.4507 46.888Z" fill="#333333"/>
                <path d="M109.648 40.424C112.784 40.424 114.736 42.024 114.736 44.872C114.736 49.8 108.624 50.44 105.68 50.472C105.808 52.552 106.992 54.568 109.712 54.568C111.6 54.568 112.976 53.704 113.744 53.16L114.928 55.688C114.416 56.136 112.304 57.48 109.296 57.48C104.016 57.48 101.84 54.088 101.84 49.288C101.84 44.584 104.56 40.424 109.648 40.424ZM111.344 45.032C111.344 43.848 110.576 43.144 109.424 43.144C106.864 43.144 105.648 45.64 105.552 48.008C107.28 48.04 111.344 47.496 111.344 45.032Z" fill="#333333"/>
                <path d="M130.638 41.544V53.928L130.926 57H127.63L127.406 55.304L127.278 55.272C126.286 56.712 124.654 57.416 122.894 57.416C118.382 57.416 116.622 54.216 116.622 49.64C116.622 44.008 119.438 40.424 124.942 40.424C125.998 40.424 128.334 40.68 130.638 41.544ZM126.862 51.912V43.624C126.382 43.4 125.454 43.208 124.462 43.208C121.422 43.208 120.398 46.056 120.398 49.512C120.398 52.168 121.038 54.696 123.726 54.696C125.71 54.696 126.862 53.288 126.862 51.912Z" fill="#333333"/>
                <path d="M138.417 34.76V50.728H138.577L144.369 40.904H148.369L144.017 48.072L148.241 57H144.209L141.489 51.24L138.001 57H134.673V34.76H138.417Z" fill="#333333"/>
            </svg>
        </a>
        <h1 id="main_heading">Accessible Stock Ticker</h1>
        <div id="stock-ticker">
            <ul class="stock-ticker-list">
                <li>
                    <div id="nifty-bank" class="stock-info">Nifty-bank: 35000</div>
                </li>
                <li>
                    <div id="sensex" class="stock-info">Sensex: 50000</div>
                </li>
                <li>
                    <div id="nifty-50" class="stock-info">Nifty-50: 15000</div>
                </li>
            </ul>
        </div>
        <span>Choose how do you want live updates announced by a screen reader.</span>
        <div class="mt-4">
            <ul class="stock-ticker-list">
                <li>
                    <button id="announceBtn" class="btn btn-primary me-2">
                        Speak
                        <span id="announceText" class="visually-hidden">Selected</span>
                    </button>
                </li>
                <li> 
                    <button id="setPoliteBtn" class="btn btn-info me-2">
                        Speak politely
                        <span id="setPoliteText" class="visually-hidden">Selected</span>
                    </button>
                </li>
                <li>
                    <button id="notAnnounceBtn" class="btn btn-secondary me-2">
                        Don't Speak
                        <span id="notAnnounceText" class="visually-hidden">Selected</span>
                    </button>
                </li>
            </ul>
        </div>
        <div class="mt-3">
        <div class="cust-pos" >
            <svg role="img" aria-label="info" fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50px" height="50px" viewBox="0 0 416.979 416.979" xml:space="preserve">
                <g>
                    <path d="M356.004,61.156c-81.37-81.47-213.377-81.551-294.848-0.182c-81.47,81.371-81.552,213.379-0.181,294.85
                        c81.369,81.47,213.378,81.551,294.849,0.181C437.293,274.636,437.375,142.626,356.004,61.156z M237.6,340.786
                        c0,3.217-2.607,5.822-5.822,5.822h-46.576c-3.215,0-5.822-2.605-5.822-5.822V167.885c0-3.217,2.607-5.822,5.822-5.822h46.576
                        c3.215,0,5.822,2.604,5.822,5.822V340.786z M208.49,137.901c-18.618,0-33.766-15.146-33.766-33.765
                        c0-18.617,15.147-33.766,33.766-33.766c18.619,0,33.766,15.148,33.766,33.766C242.256,122.755,227.107,137.901,208.49,137.901z">
                    </path>
                </g>
            </svg>
            <p>       
                Stock tickers tend to auto-update the stock price information in real-time. So while using this stock ticker on a live site, in order to conform to WCAG success criteria 2.2.2 Pause, Stop, Hide at Level A, it is recommended to add Pause/Resume buttons to help to stop and restart the auto-update.
                Pause button will stop the update and Resume button will restart the update with a notice that it is not the current update. Provide users with a control to view the latest updates. 
            </p>
            
        </div>
    </div>
    
        <!-- ARIA live region for screen reader announcements -->
        <div id="announcement" class="mt-3 visually-hidden" aria-hidden="true"></div>
        <div class="copyright">
            © 2024 BarrierBreak Solutions Pvt. Ltd. All Rights Reserved.
        </div>
    </div>

<script>
    const niftyBank = document.getElementById('nifty-bank');
    const sensex = document.getElementById('sensex');
    const nifty50 = document.getElementById('nifty-50');
    const announceBtn = document.getElementById('announceBtn');
    const notAnnounceBtn = document.getElementById('notAnnounceBtn');
    const setPoliteBtn = document.getElementById('setPoliteBtn');
    let announce = true; // Flag to track announcement state

    function updateButtonText(button, selected) {
        const hiddenText = button.querySelector('.visually-hidden');
        hiddenText.textContent = selected ? 'Selected' : '';
    }


    let prevNiftyBank, prevSensex, prevNifty50;

    const initialData = {
        nifty_bank: 35000,
        sensex: 50000,
        nifty_50: 15000
    };


    function updateTicker() {
        fetch('/get_data')
            .then(response => response.json())
            .then(data => {
                if (!initialData) {
                    initialData = data; // Store initial values if not already stored
                }
                const currentIndex = Math.floor(Date.now() / 5000) % data.length;
                const currentData = data[currentIndex];

                const niftyBankChange = calculatePercentageChange(initialData.nifty_bank, currentData.nifty_bank);
                const sensexChange = calculatePercentageChange(initialData.sensex, currentData.sensex);
                const nifty50Change = calculatePercentageChange(initialData.nifty_50, currentData.nifty_50);

                const arrowNiftyBank = getArrowAndChange(initialData.nifty_bank, currentData.nifty_bank, 'nifty-bank');
                const arrowSensex = getArrowAndChange(initialData.sensex, currentData.sensex, 'sensex');
                const arrowNifty50 = getArrowAndChange(initialData.nifty_50, currentData.nifty_50, 'nifty-50');

                displayStockInfo('nifty-bank', currentData.nifty_bank, niftyBankChange, arrowNiftyBank.arrow);
                displayStockInfo('sensex', currentData.sensex, sensexChange, arrowSensex.arrow);
                displayStockInfo('nifty-50', currentData.nifty_50, nifty50Change, arrowNifty50.arrow);

                if (announce) {
                    announceStockValues(currentData, arrowNiftyBank, arrowSensex, arrowNifty50);
                }
            });
    }

        function calculatePercentageChange(initialValue, newValue) {
            const change = ((newValue - initialValue) / initialValue) * 100;
            return change.toFixed(2);
        }

        function displayStockInfo(id, value, percentageChange, arrow) {
            const indexName = id.replace('-', ' ').replace(/\b\w/g, firstLetter => firstLetter.toUpperCase());
            const formattedPercentageChange = percentageChange > 0 ? `+${percentageChange}` : percentageChange;
            document.getElementById(id).innerHTML = `${indexName}: ${value} (${arrow} ${formattedPercentageChange}%)`;
        }


    function announceStockValues(data, arrowNiftyBank, arrowSensex, arrowNifty50) {
        let announcement = '';
        if (arrowNiftyBank.change === 'Increasing') {
            announcement += ` Nifty Bank ${data.nifty_bank} &plus;${arrowNiftyBank.percentChange}% `;
        } else if (arrowNiftyBank.change === 'Decreasing') {
            announcement += ` Nifty Bank ${data.nifty_bank} ${arrowNiftyBank.percentChange.replace('-', '&minus;')}% `;
        }

        if (arrowSensex.change === 'Increasing') {
            announcement += ` Sensex ${data.sensex} &plus;${arrowSensex.percentChange}% `;
        } else if (arrowSensex.change === 'Decreasing') {
            announcement += ` Sensex ${data.sensex} ${arrowSensex.percentChange.replace('-', '&minus;')}% `;
        }

        if (arrowNifty50.change === 'Increasing') {
            announcement += ` Nifty 50 ${data.nifty_50} &plus;${arrowNifty50.percentChange}% `;
        } else if (arrowNifty50.change === 'Decreasing') {
            announcement += ` Nifty 50 ${data.nifty_50} ${arrowNifty50.percentChange.replace('-', '&minus;')}% `;
        }

        document.getElementById('announcement').textContent = announcement.trim();
    }

    function getArrowAndChange(prevValue, newValue, id) {
        if (prevValue === undefined || newValue === prevValue) {
            return { arrow: '', change: 'No change', percentChange: 0 };
        }

        const percentChange = ((newValue - prevValue) / prevValue * 100).toFixed(2);
        const arrow = newValue > prevValue ? '<span aria-hidden="true" class="up-arrow">&#x25B2;</span>' : '<span aria-hidden="true" class="down-arrow">&#x25BC;</span>';
        const change = newValue > prevValue ? 'Increasing' : 'Decreasing';
        const formattedPercentChange = newValue > prevValue ? `+${percentChange}` : percentChange;
        document.getElementById(id).innerHTML = `${id.charAt(0).toUpperCase() + id.slice(1)}: ${newValue} (${arrow} ${formattedPercentChange}%)`;
        return { arrow, change, percentChange };
    }

    announceBtn.addEventListener('click', () => {
        announce = true;
        document.getElementById('stock-ticker').setAttribute('aria-live', 'assertive');
        document.getElementById('stock-ticker').setAttribute('aria-atomic', 'true');
        updateButtonText(announceBtn, true);
        updateButtonText(notAnnounceBtn, false);
        updateButtonText(setPoliteBtn, false);
        announceBtn.style.textDecoration = 'underline'; // Add underline to the button text
        notAnnounceBtn.style.textDecoration = 'none'; // Remove underline from other buttons
        setPoliteBtn.style.textDecoration = 'none';
    });

    notAnnounceBtn.addEventListener('click', () => {
        announce = false;
        document.getElementById('stock-ticker').removeAttribute('aria-live', 'polite');
        document.getElementById('stock-ticker').removeAttribute('aria-atomic', 'true');
        updateButtonText(announceBtn, false);
        updateButtonText(notAnnounceBtn, true);
        updateButtonText(setPoliteBtn, false);
        announceBtn.style.textDecoration = 'none';
        notAnnounceBtn.style.textDecoration = 'underline';
        setPoliteBtn.style.textDecoration = 'none';
    });

    setPoliteBtn.addEventListener('click', () => {
        announce = true;
        document.getElementById('stock-ticker').setAttribute('aria-live', 'polite');
        document.getElementById('stock-ticker').setAttribute('aria-atomic', 'true');
        updateButtonText(announceBtn, false);
        updateButtonText(notAnnounceBtn, false);
        updateButtonText(setPoliteBtn, true);
        announceBtn.style.textDecoration = 'none';
        notAnnounceBtn.style.textDecoration = 'none';
        setPoliteBtn.style.textDecoration = 'underline';
    });

    window.addEventListener('load', () => {
        document.getElementById('announceText').textContent = '';
        document.getElementById('notAnnounceText').textContent = 'Selected';
        notAnnounceBtn.style.textDecoration = 'underline';
        document.getElementById('setPoliteText').textContent = '';
    });

    setInterval(updateTicker, 12000); // Update ticker every 5 seconds

    // Initial update final code
    updateTicker();
</script>

</body>
</html>
